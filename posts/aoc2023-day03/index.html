<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="This year I try to record my attempt at solving the Advent of Code 2023 riddles. This is Day 3 - see https:adventofcode.com/2023/day/3
Part 1 # Lets first read the task:
The engine schematic (your puzzle input) consists of a visual representation of the engine. There are lots of numbers and symbols you don&rsquo;t really understand, but apparently any number adjacent to a symbol, even diagonally, is a &ldquo;part number&rdquo; and should be included in your sum.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Advent of code 2023 - Day 3: Gear Ratios" />
<meta property="og:description" content="This year I try to record my attempt at solving the Advent of Code 2023 riddles. This is Day 3 - see https:adventofcode.com/2023/day/3
Part 1 # Lets first read the task:
The engine schematic (your puzzle input) consists of a visual representation of the engine. There are lots of numbers and symbols you don&rsquo;t really understand, but apparently any number adjacent to a symbol, even diagonally, is a &ldquo;part number&rdquo; and should be included in your sum." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://aseltmann.github.io/posts/aoc2023-day03/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-18T01:01:00+01:00" />
<meta property="article:modified_time" content="2023-12-18T20:39:24+01:00" />

<title>Advent of code 2023 - Day 3: Gear Ratios | Blog &amp; Notes</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="alternate" hreflang="de" href="https://aseltmann.github.io/de/posts/aoc2023-day03/" title="Advent of code 2023 - Tag 3: Gear Ratios">

<link rel="stylesheet" href="/book.min.d7627a3c5cf990a6cefa3a3ba897fad0150917026ac2f51e3d7b8a903c5b31a0.css" integrity="sha256-12J6PFz5kKbO&#43;jo7qJf60BUJFwJqwvUePXuKkDxbMaA=">
<script defer src="/en.search.min.850c402b9e935a48b4bc24477b96c346ae5ff8f7fd5966e16c21aaeda0b25873.js" integrity="sha256-hQxAK56TWki0vCRHe5bDRq5f&#43;Pf9WWbhbCGq7aCyWHM="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
    <h2 class="book-brand">
    <a href="/">
        <span>Blog &amp; Notes</span>
    </a>
</h2>

    <a href="/">
        
        <img src="/book_logo.png" alt="Logo" width="100%"/>
        
    </a>
    
<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>


    <ul>
    <li>
        <a href="/posts/">Blog</a>
    </li>
</ul>


    
    



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>Notes</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://aseltmann.github.io/docs/notes/poetry/" class="">Poetry</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aseltmann.github.io/docs/projects/" class="">Projects</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>







    

    




    
</nav>




<script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Advent of code 2023 - Day 3: Gear Ratios</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#part-1">Part 1</a></li>
    <li><a href="#part-2">Part 2</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/posts/aoc2023-day03/">Advent of code 2023 - Day 3: Gear Ratios</a>
  </h1>
  
  <h5>2023-12-18</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  


  <p><p>This year I try to record my attempt at solving the <strong>Advent of Code 2023</strong>
riddles. This is Day 3 - see <a href="https:adventofcode.com/2023/day/3">https:adventofcode.com/2023/day/3</a></p>
<h2 id="part-1">
  Part 1
  <a class="anchor" href="#part-1">#</a>
</h2>
<p>Lets first read the task:</p>
<blockquote>
<p>The engine schematic (your puzzle input) consists of a visual representation of
the engine. There are lots of numbers and symbols you don&rsquo;t really understand,
but apparently <strong>any number adjacent to a symbol</strong>, even diagonally, is a &ldquo;part
number&rdquo; and should be included in your sum. (Periods (<code>.</code>) do not count as a
symbol.)</p>
<p>Here is an example engine schematic:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>467..114..
</span></span><span style="display:flex;"><span>...*......
</span></span><span style="display:flex;"><span>..35..633.
</span></span><span style="display:flex;"><span>......#...
</span></span><span style="display:flex;"><span>617*......
</span></span><span style="display:flex;"><span>.....+.58.
</span></span><span style="display:flex;"><span>..592.....
</span></span><span style="display:flex;"><span>......755.
</span></span><span style="display:flex;"><span>...$.*....
</span></span><span style="display:flex;"><span>.664.598..
</span></span></code></pre></div><blockquote>
<p>In this schematic, two numbers are not part numbers because they are not
adjacent to a symbol: <code>114</code> (top right) and <code>58</code> (middle right). Every other
number is adjacent to a symbol and so is a part number; their sum is <code>4361</code>.</p>
<p>Of course, the actual engine schematic is much larger. <strong>What is the sum of all of
the part numbers in the engine schematic</strong>?</p>
</blockquote>
<p>Okay, let&rsquo;s first get the input as a <code>numpy</code> character array</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  <span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">from</span> scipy <span style="color:#f92672">import</span> ndimage <span style="color:#66d9ef">as</span> ndi
</span></span><span style="display:flex;"><span>  np<span style="color:#f92672">.</span>set_printoptions(threshold<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>maxsize)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  txt <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_table(<span style="color:#e6db74">&#39;data/2023-12-03-1-aoc.txt&#39;</span>, names<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;code&#39;</span>])
</span></span><span style="display:flex;"><span>  arr <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>chararray((txt<span style="color:#f92672">.</span>size, txt<span style="color:#f92672">.</span>size), unicode<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  txt[<span style="color:#e6db74">&#39;code&#39;</span>] <span style="color:#f92672">=</span> txt<span style="color:#f92672">.</span>loc[:, <span style="color:#e6db74">&#39;code&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: [i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> x])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> i, code <span style="color:#f92672">in</span> enumerate(txt[<span style="color:#e6db74">&#39;code&#39;</span>]):
</span></span><span style="display:flex;"><span>      arr[i, :] <span style="color:#f92672">=</span> code
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  print((arr[:<span style="color:#ae81ff">15</span>, :<span style="color:#ae81ff">15</span>]))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[[&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;5&#39; &#39;3&#39; &#39;.&#39; &#39;4&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;*&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;7&#39; &#39;2&#39; &#39;6&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;9&#39; &#39;5&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;7&#39; &#39;3&#39; &#39;8&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;*&#39; &#39;.&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;7&#39; &#39;4&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;3&#39; &#39;6&#39; &#39;6&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;*&#39; &#39;1&#39; &#39;2&#39; &#39;6&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;3&#39; &#39;3&#39; &#39;1&#39; &#39;/&#39; &#39;.&#39; &#39;.&#39; &#39;9&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;/&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;*&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;9&#39; &#39;5&#39; &#39;3&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;3&#39; &#39;5&#39; &#39;5&#39; &#39;.&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;6&#39; &#39;8&#39; &#39;5&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;*&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;7&#39; &#39;0&#39;]
</span></span><span style="display:flex;"><span> [&#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;.&#39; &#39;9&#39; &#39;3&#39; &#39;8&#39; &#39;.&#39; &#39;.&#39; &#39;*&#39;]]
</span></span></code></pre></div><p>Now extract symbols, digits and the empty space. We use the <code>numpy</code> character
methods for that. This way, we create a binary mask for all <strong>digits</strong> and a
binary mask for all <strong>empty</strong> space (<code>.</code>). The <strong>symbols</strong> are then every character
which is neither.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  digits <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>char<span style="color:#f92672">.</span>isdigit(arr)
</span></span><span style="display:flex;"><span>  empty <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>char<span style="color:#f92672">.</span>endswith(arr, <span style="color:#e6db74">&#39;.&#39;</span>)
</span></span><span style="display:flex;"><span>  symbols <span style="color:#f92672">=</span> <span style="color:#f92672">~</span>(digits <span style="color:#f92672">|</span> empty)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># just for visualization</span>
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">131</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;symbols&#39;</span>)<span style="color:#f92672">.</span>matshow(symbols)
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">132</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;digits&#39;</span>)<span style="color:#f92672">.</span>matshow(digits)
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">133</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;empty&#39;</span>)<span style="color:#f92672">.</span>matshow(empty)
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><figure><img src="/ox-hugo/92e5476ffb971069e91ebd51b0733f8d067ed4f0.png"/>
</figure>

<p>Now we use the image processing technique of dilation on the <code>symbols</code> mask. So
that we get a new mask which covers the surroundings of all symbols. We use this
afterwards to check if the digits are near a symbol.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  struct <span style="color:#f92672">=</span> ((<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>), (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>), (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>  dilate <span style="color:#f92672">=</span> ndi<span style="color:#f92672">.</span>binary_dilation(symbols, structure<span style="color:#f92672">=</span>struct)
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">121</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;symbols&#39;</span>)<span style="color:#f92672">.</span>matshow(symbols[:<span style="color:#ae81ff">15</span>, :<span style="color:#ae81ff">15</span>])
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">122</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;symbols dilated&#39;</span>)<span style="color:#f92672">.</span>matshow(dilate[:<span style="color:#ae81ff">15</span>, :<span style="color:#ae81ff">15</span>])
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><figure><img src="/ox-hugo/c6e63862aef82ff3f8a64ff3686fb8f7fe239f65.png"/>
</figure>

<p>Creating this masks as before could be understood as a <strong>binary segmentation</strong>, as
each element in our mask is either <code>True</code> or <code>False</code>. To extract the single
digits, we&rsquo;ll convert the binary digits segmentation into a <strong>instance
segmentation</strong>, where each connected segment has an own index.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  markers, num_features <span style="color:#f92672">=</span> ndi<span style="color:#f92672">.</span>label(digits)
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">121</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;binary segmentation&#39;</span>)<span style="color:#f92672">.</span>matshow(
</span></span><span style="display:flex;"><span>      digits[:<span style="color:#ae81ff">15</span>, :<span style="color:#ae81ff">15</span>])
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">122</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;instance segmentation&#39;</span>)<span style="color:#f92672">.</span>matshow(
</span></span><span style="display:flex;"><span>      markers[:<span style="color:#ae81ff">15</span>, :<span style="color:#ae81ff">15</span>], cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gnuplot&#39;</span>)
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><figure><img src="/ox-hugo/73d9894da10ebf83909ef909e542f608e4d4a097.png"/>
</figure>

<p>Now, for each instance, we check if the dilated binary mask overlaps with the
instance and if yes, we extract the number.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  numbers <span style="color:#f92672">=</span> [int(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(arr[markers <span style="color:#f92672">==</span> i]))
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, num_features<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>any((markers <span style="color:#f92672">==</span> i) <span style="color:#f92672">&amp;</span> dilate)]
</span></span></code></pre></div><p>Then, we just sum up:</p>
<details>
<summary>Reveal solution!</summary>
<div class="details">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  sum(numbers)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>527364
</span></span></code></pre></div></div>
</details>
<h2 id="part-2">
  Part 2
  <a class="anchor" href="#part-2">#</a>
</h2>
<blockquote>
<p>The missing part wasn&rsquo;t the only issue - one of the gears in the engine is
wrong. A gear is any * symbol that is adjacent to exactly two part numbers. Its
gear ratio is the result of multiplying those two numbers together.</p>
<p>This time, you need to find the gear ratio of every gear and add them all up so
that the engineer can figure out which gear needs to be replaced.</p>
<p>Consider the same engine schematic again:The missing part wasn&rsquo;t the only
issue - one of the gears in the engine is wrong. A gear is any * symbol that is
adjacent to exactly two part numbers. Its gear ratio is the result of
multiplying those two numbers together.</p>
<p>This time, you need to find the gear ratio of every gear and add them all up so
that the engineer can figure out which gear needs to be replaced.</p>
<p>Consider the same engine schematic again:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>467..114..
</span></span><span style="display:flex;"><span>...*......
</span></span><span style="display:flex;"><span>..35..633.
</span></span><span style="display:flex;"><span>......#...
</span></span><span style="display:flex;"><span>617*......
</span></span><span style="display:flex;"><span>.....+.58.
</span></span><span style="display:flex;"><span>..592.....
</span></span><span style="display:flex;"><span>......755.
</span></span><span style="display:flex;"><span>...$.*....
</span></span><span style="display:flex;"><span>.664.598..
</span></span></code></pre></div><blockquote>
<p>In this schematic, there are <strong>two</strong> gears. The first is in the top left; it has
part numbers <code>467</code> and <code>35</code>, so its gear ratio is <code>16345</code>. The second gear is in
the lower right; its gear ratio is <code>451490</code>. (The <code>*</code> adjacent to <code>617</code> is not a
gear because it is only adjacent to one part number.) Adding up all of the gear
ratios produces <code>467835</code>.</p>
<p><strong>What is the sum of all of the gear ratios in your engine schematic?</strong></p>
</blockquote>
<p>We&rsquo;ll use the same method as before, but this time only extract <code>*</code> and create
the instance segmentation <strong>before</strong> the dilation. Why? Because when we dilate
first, we could merge two independent gears into one instance.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  gear <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>char<span style="color:#f92672">.</span>endswith(arr, <span style="color:#e6db74">&#39;*&#39;</span>)
</span></span><span style="display:flex;"><span>  gear_markers, gear_num <span style="color:#f92672">=</span> ndi<span style="color:#f92672">.</span>label(gear)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">131</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;all symbols dilated&#39;</span>)<span style="color:#f92672">.</span>matshow(
</span></span><span style="display:flex;"><span>      symbols[:<span style="color:#ae81ff">15</span>, :<span style="color:#ae81ff">15</span>])
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">132</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gears&#39;</span>)<span style="color:#f92672">.</span>matshow(
</span></span><span style="display:flex;"><span>      gear[:<span style="color:#ae81ff">15</span>, :<span style="color:#ae81ff">15</span>])
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">133</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gears instances&#39;</span>)<span style="color:#f92672">.</span>matshow(
</span></span><span style="display:flex;"><span>      gear_markers[:<span style="color:#ae81ff">15</span>, :<span style="color:#ae81ff">15</span>], cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gnuplot&#39;</span>)
</span></span><span style="display:flex;"><span>  plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><figure><img src="/ox-hugo/ae256a47b14244f1e8f55b38b4c1f4621e0f2187.png"/>
</figure>

<p>Now, we step through each gear instance, create a mask for that gear, dilate it,
and then step through all digits and check if they are in the gear mask. If we
get two digits in the end, we multiply them to get the dear ratio and save the
ratios to a list.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  gear_ratios <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, gear_num<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>      gear_binary <span style="color:#f92672">=</span> gear_markers <span style="color:#f92672">==</span> i
</span></span><span style="display:flex;"><span>      gear_dil <span style="color:#f92672">=</span> ndi<span style="color:#f92672">.</span>binary_dilation(gear_binary, structure<span style="color:#f92672">=</span>struct)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      part_numbers <span style="color:#f92672">=</span> [int(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(arr[markers <span style="color:#f92672">==</span> j]))
</span></span><span style="display:flex;"><span>                      <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, num_features<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>                      <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>any((markers <span style="color:#f92672">==</span> j) <span style="color:#f92672">&amp;</span> gear_dil)]
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> len(part_numbers) <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>          gear_ratios<span style="color:#f92672">.</span>append(part_numbers[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> part_numbers[<span style="color:#ae81ff">1</span>])
</span></span></code></pre></div><p>Now, we just sum the output again:</p>
<details>
<summary>Reveal solution!</summary>
<div class="details">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  sum(gear_ratios)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>79026871
</span></span></code></pre></div></div>
</details>
</p>
</article>
 
      

      <footer class="book-footer">
          
  <div class="flex flex-wrap justify-between">

  


  

  


  


<div class="book-languages" tabindex="0" aria-haspopup="true">
  <ul>
    <li class="flex align-center">
      <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
      English
    </li> 
  </ul>

  <ul class="book-languages-list">
    
    <li class="active">
      <a href="https://aseltmann.github.io/" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </li>
    
    <li class="">
      <a href="https://aseltmann.github.io/de/posts/aoc2023-day03/" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        Deutsch
      </a>
    </li>
    
  </ul>
</div>




  <div><a class="flex align-center" href="https://github.com/aseltmann/aseltmann.github.io-org-src/commit/1d08d477a60625557ac96f24ab15cdd39f7c22df" title='Last modified by Alex Seltmann | 2023-12-18' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>2023-12-18</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/aseltmann/aseltmann.github.io-org-src/edit/main/content//posts/aoc2023-day03.en.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>

</div>

 
      </footer>

      
  
  <div class="book-comments">
<div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "lexbn" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
  
 

      <footer class="book-footer">
          <div class="footer">
    
    
    Exported
    
    from <a href="https://github.com/aseltmann/aseltmann.github.io-org-src/raw/main/lexbn-source.org"> <code>lexbn-source.org</code></a>
    
    using
    
    <a href="https://www.gnu.org/software/emacs/">Emacs 29.1 </a> &plus;
    <a href="https://orgmode.org/">Org mode 9.7 </a> &plus;
    
    <a href="https://github.com/kaushalmodi/ox-hugo"><code>ox-hugo</code></a>
    and published using
    
    <a href="https://gohugo.io/">Hugo 0.120.1</a>
	  &plus; <a href="https://github.com/alex-shpak/hugo-book">Book</a>
    
</div>



 
      </footer>


      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#part-1">Part 1</a></li>
    <li><a href="#part-2">Part 2</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












