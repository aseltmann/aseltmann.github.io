<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="This year I try to record my attempt at solving the Advent of Code 2023 riddles. This is Day 5 - see https:adventofcode.com/2023/day/5
Update [2023-12-31 So]:
subsitute get_generator() (own implementation) with range() (Python inbuilt) improve grid search so that it goes through all location ranges, still starting with the lowest range Part 1 # Lets first read the task:
The almanac (your puzzle input) lists all of the seeds that need to be planted.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Advent of code 2023 - Day 5: If You Give A Seed A Fertilizer" />
<meta property="og:description" content="This year I try to record my attempt at solving the Advent of Code 2023 riddles. This is Day 5 - see https:adventofcode.com/2023/day/5
Update [2023-12-31 So]:
subsitute get_generator() (own implementation) with range() (Python inbuilt) improve grid search so that it goes through all location ranges, still starting with the lowest range Part 1 # Lets first read the task:
The almanac (your puzzle input) lists all of the seeds that need to be planted." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://aseltmann.github.io/posts/aoc2023-day05/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-30T01:10:00+01:00" />
<meta property="article:modified_time" content="2023-12-31T01:20:57+01:00" />

<title>Advent of code 2023 - Day 5: If You Give A Seed A Fertilizer | Blog &amp; Notes</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="alternate" hreflang="de" href="https://aseltmann.github.io/de/posts/aoc2023-day05/" title="Advent of code 2023 - Tag 5: Wenn Du Einem Samen DÃ¼nger Gibst">

<link rel="stylesheet" href="/book.min.d7627a3c5cf990a6cefa3a3ba897fad0150917026ac2f51e3d7b8a903c5b31a0.css" integrity="sha256-12J6PFz5kKbO&#43;jo7qJf60BUJFwJqwvUePXuKkDxbMaA=">
<script defer src="/en.search.min.862847e1704312038d7264b61b8fbd061a750eddaca50a7f50b83bb76c7c23ce.js" integrity="sha256-hihH4XBDEgONcmS2G4&#43;9Bhp1Dt2spQp/ULg7t2x8I84="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
    <h2 class="book-brand">
    <a href="/">
        <span>Blog &amp; Notes</span>
    </a>
</h2>

    <a href="/">
        
        <img src="/book_logo.png" alt="Logo" width="100%"/>
        
    </a>
    
<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>


    <ul>
    <li>
        <a href="/posts/">Blog</a>
    </li>
</ul>


    
    



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>Notes</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://aseltmann.github.io/docs/notes/poetry/" class="">Poetry</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aseltmann.github.io/docs/projects/" class="">Projects</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>







    

    




    
</nav>




<script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Advent of code 2023 - Day 5: If You Give A Seed A Fertilizer</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#part-1">Part 1</a></li>
    <li><a href="#part-2">Part 2</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/posts/aoc2023-day05/">Advent of code 2023 - Day 5: If You Give A Seed A Fertilizer</a>
  </h1>
  
  <h5>2023-12-30</h5>



  

  
  <div>
    
      <a href="/tags/python/">python</a>
  </div>
  


  <p><p>This year I try to record my attempt at solving the <strong>Advent of Code 2023</strong>
riddles. This is Day 5 - see <a href="https:adventofcode.com/2023/day/5">https:adventofcode.com/2023/day/5</a></p>
<p>Update <span class="timestamp-wrapper"><span class="timestamp">[2023-12-31 So]</span></span>:</p>
<ul>
<li>subsitute get_generator() (own implementation) with range() (Python inbuilt)</li>
<li>improve grid search so that it goes through all location ranges, still
starting with the lowest range</li>
</ul>
<h2 id="part-1">
  Part 1
  <a class="anchor" href="#part-1">#</a>
</h2>
<p>Lets first read the task:</p>
<blockquote>
<p>The almanac (your puzzle input) lists all of the seeds that need to be planted.
It also lists what type of soil to use with each kind of seed, what type of
fertilizer to use with each kind of soil, what type of water to use with each
kind of fertilizer, and so on. Every type of seed, soil, fertilizer and so on is
identified with a number, but numbers are reused by each category - that is,
soil <code>123</code> and fertilizer <code>123</code> aren&rsquo;t necessarily related to each other.</p>
<p>For example:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>seeds: 79 14 55 13
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>seed-to-soil map:
</span></span><span style="display:flex;"><span>50 98 2
</span></span><span style="display:flex;"><span>52 50 48
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>soil-to-fertilizer map:
</span></span><span style="display:flex;"><span>0 15 37
</span></span><span style="display:flex;"><span>37 52 2
</span></span><span style="display:flex;"><span>39 0 15
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fertilizer-to-water map:
</span></span><span style="display:flex;"><span>49 53 8
</span></span><span style="display:flex;"><span>0 11 42
</span></span><span style="display:flex;"><span>42 0 7
</span></span><span style="display:flex;"><span>57 7 4
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>water-to-light map:
</span></span><span style="display:flex;"><span>88 18 7
</span></span><span style="display:flex;"><span>18 25 70
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>light-to-temperature map:
</span></span><span style="display:flex;"><span>45 77 23
</span></span><span style="display:flex;"><span>81 45 19
</span></span><span style="display:flex;"><span>68 64 13
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>temperature-to-humidity map:
</span></span><span style="display:flex;"><span>0 69 1
</span></span><span style="display:flex;"><span>1 0 69
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>humidity-to-location map:
</span></span><span style="display:flex;"><span>60 56 37
</span></span><span style="display:flex;"><span>56 93 4
</span></span></code></pre></div><blockquote>
<p>The almanac starts by listing which seeds need to be planted: seeds <code>79</code>, <code>14</code>,
<code>55</code>, and <code>13</code>.</p>
<p>The rest of the almanac contains a list of <strong>maps</strong> which describe how to convert
numbers from a <strong>source category</strong> into numbers in a <strong>destination category</strong>. That
is, the section that starts with <code>seed-to-soil map</code>: describes how to convert a
<strong>seed number</strong> (the source) to a <strong>soil number</strong> (the destination). This lets the
gardener and his team know which soil to use with which seeds, which water to
use with which fertilizer, and so on.</p>
<p>Rather than list every source number and its corresponding destination number
one by one, the maps describe entire <strong>ranges</strong> of numbers that can be converted.
Each line within a map contains three numbers: the <strong>destination range start</strong>,
the <strong>source range start</strong>, and the <strong>range length</strong>.</p>
<p>Consider again the example <code>seed-to-soil map</code>:</p>
<p><code>50 98 2 52 50 48</code></p>
<p>The first line has a <strong>destination range start</strong> of <code>50</code>, a <strong>source range start</strong>
of <code>98</code>, and a <strong>range length</strong> of <code>2</code>. This line means that the source range
starts at <code>98</code> and contains two values: <code>98</code> and <code>99</code>. The destination range is
the same length, but it starts at <code>50</code>, so its two values are <code>50</code> and <code>51</code>.
With this information, you know that seed number <code>98</code> corresponds to soil number
<code>50</code> and that seed number <code>99</code> corresponds to soil number <code>51</code>.
o
The second line means that the source range starts at <code>50</code> and contains <code>48</code>
values: <code>50</code>, <code>51</code>, &hellip;, <code>96</code>, <code>97</code>. This corresponds to a destination range
starting at <code>52</code> and also containing <code>48</code> values: <code>52</code>, <code>53</code>, &hellip;, <code>98</code>, <code>99</code>.
So, seed number <code>53</code> corresponds to soil number <code>55</code>.</p>
<p>Any source numbers that <strong>aren&rsquo;t mapped</strong> correspond to the <strong>same</strong> destination
number. So, seed number <code>10</code> corresponds to soil number <code>10</code>.</p>
<p>So, the entire list of seed numbers and their corresponding soil numbers looks
like this:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>seed  soil
</span></span><span style="display:flex;"><span>0     0
</span></span><span style="display:flex;"><span>1     1
</span></span><span style="display:flex;"><span>...   ...
</span></span><span style="display:flex;"><span>48    48
</span></span><span style="display:flex;"><span>49    49
</span></span><span style="display:flex;"><span>50    52
</span></span><span style="display:flex;"><span>51    53
</span></span><span style="display:flex;"><span>...   ...
</span></span><span style="display:flex;"><span>96    98
</span></span><span style="display:flex;"><span>97    99
</span></span><span style="display:flex;"><span>98    50
</span></span><span style="display:flex;"><span>99    51
</span></span></code></pre></div><blockquote>
<p>With this map, you can look up the soil number required for each initial seed
number:</p>
<ul>
<li>Seed number <code>79</code> corresponds to soil number <code>81</code>.</li>
<li>Seed number <code>14</code> corresponds to soil number <code>14</code>.</li>
<li>Seed number <code>55</code> corresponds to soil number <code>57</code>.</li>
<li>Seed number <code>13</code> corresponds to soil number <code>13</code>.</li>
</ul>
<p>The gardener and his team want to get started as soon as possible, so they&rsquo;d
like to know the closest location that needs a seed. Using these maps, find <strong>the
lowest location number that corresponds to any of the initial seeds</strong>. To do
this, you&rsquo;ll need to convert each seed number through other categories until you
can find its corresponding <strong>location number</strong>. In this example, the corresponding
types are:</p>
<ul>
<li>Seed <code>79</code>, soil <code>81</code>, fertilizer <code>81</code>, water <code>81</code>, light <code>74</code>, temperature
<code>78</code>, humidity <code>78</code>, location <code>82</code>.</li>
<li>Seed <code>14</code>, soil <code>14</code>, fertilizer <code>53</code>, water <code>49</code>, light <code>42</code>, temperature
<code>42</code>, humidity <code>43</code>, location <code>43</code>.</li>
<li>Seed <code>55</code>, soil <code>57</code>, fertilizer <code>57</code>, water <code>53</code>, light <code>46</code>, temperature
<code>82</code>, humidity <code>82</code>, location <code>86</code>.</li>
<li>Seed <code>13</code>, soil <code>13</code>, fertilizer <code>52</code>, water <code>41</code>, light <code>34</code>, temperature
<code>34</code>, humidity <code>35</code>, location <code>35</code>.</li>
</ul>
<p>So, the lowest location number in this example is <code>35</code>.</p>
<p><strong>What is the lowest location number that corresponds to any of the initial seed
numbers?</strong></p>
</blockquote>
<p>Wow, this task is a mouthful&hellip;</p>
<p>Let&rsquo;s start slowly and load the data. Our input text document contains several
maps, which are clearly separated and have a title (<code>seed-to-soil map</code> etc). So
we can tell pandas where each map starts and give each map a dataframe. I got
the values for the <code>skiprows</code> and <code>nrows</code> argument by looking at the input file
and&hellip; counting
:)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>seeds <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_table(<span style="color:#e6db74">&#39;data/2023-12-05-1-aoc.txt&#39;</span>, nrows<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39; &#39;</span>,
</span></span><span style="display:flex;"><span>                      header<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, index_col<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>seeds <span style="color:#f92672">=</span> seeds<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>flatten()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>map_opt <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;filepath_or_buffer&#39;</span>: <span style="color:#e6db74">&#39;data/2023-12-05-1-aoc.txt&#39;</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#e6db74">&#39;header&#39;</span>: <span style="color:#66d9ef">None</span>, <span style="color:#e6db74">&#39;sep&#39;</span>: <span style="color:#e6db74">&#39; &#39;</span>, <span style="color:#e6db74">&#39;dtype&#39;</span>: <span style="color:#e6db74">&#39;Int64&#39;</span>,
</span></span><span style="display:flex;"><span>           <span style="color:#e6db74">&#39;names&#39;</span>: [<span style="color:#e6db74">&#39;dest_start&#39;</span>, <span style="color:#e6db74">&#39;src_start&#39;</span>, <span style="color:#e6db74">&#39;range&#39;</span>]}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>seed_soil <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_table(skiprows<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, nrows<span style="color:#f92672">=</span><span style="color:#ae81ff">23</span>, <span style="color:#f92672">**</span>map_opt)
</span></span><span style="display:flex;"><span>soil_fert <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_table(skiprows<span style="color:#f92672">=</span><span style="color:#ae81ff">28</span>, nrows<span style="color:#f92672">=</span><span style="color:#ae81ff">9</span>, <span style="color:#f92672">**</span>map_opt)
</span></span><span style="display:flex;"><span>fert_water <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_table(skiprows<span style="color:#f92672">=</span><span style="color:#ae81ff">39</span>, nrows<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, <span style="color:#f92672">**</span>map_opt)
</span></span><span style="display:flex;"><span>water_light <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_table(skiprows<span style="color:#f92672">=</span><span style="color:#ae81ff">61</span>, nrows<span style="color:#f92672">=</span><span style="color:#ae81ff">40</span>, <span style="color:#f92672">**</span>map_opt)
</span></span><span style="display:flex;"><span>light_temp <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_table(skiprows<span style="color:#f92672">=</span><span style="color:#ae81ff">103</span>, nrows<span style="color:#f92672">=</span><span style="color:#ae81ff">36</span>, <span style="color:#f92672">**</span>map_opt)
</span></span><span style="display:flex;"><span>temp_humi <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_table(skiprows<span style="color:#f92672">=</span><span style="color:#ae81ff">141</span>, nrows<span style="color:#f92672">=</span><span style="color:#ae81ff">35</span>, <span style="color:#f92672">**</span>map_opt)
</span></span><span style="display:flex;"><span>humi_loc <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_table(skiprows<span style="color:#f92672">=</span><span style="color:#ae81ff">178</span>, nrows<span style="color:#f92672">=</span><span style="color:#ae81ff">26</span>, <span style="color:#f92672">**</span>map_opt)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>maps <span style="color:#f92672">=</span> (seed_soil, soil_fert, fert_water, water_light, light_temp,
</span></span><span style="display:flex;"><span>        temp_humi, humi_loc)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;seeds are just a numpy array:&#39;</span>)
</span></span><span style="display:flex;"><span>display(seeds)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;The &#34;humidity-to-location&#34; map as an example:&#39;</span>)
</span></span><span style="display:flex;"><span>humi_loc
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>seeds are just a numpy array:
</span></span><span style="display:flex;"><span>array([3169137700,  271717609, 3522125441,   23376095, 1233948799,
</span></span><span style="display:flex;"><span>        811833837,  280549587,  703867355,  166086528,   44766996,
</span></span><span style="display:flex;"><span>       2326968141,   69162222, 2698492851,   14603069, 2755327667,
</span></span><span style="display:flex;"><span>        348999531, 2600461189,   92332846, 1054656969,  169099767])
</span></span><span style="display:flex;"><span>The &#34;humidity-to-location&#34; map as an example:
</span></span></code></pre></div><p>My first attempt was to actually construct ranges like in the example above,
mapping out all possible sources and destinations. Python quickly informed me
that even constructing one <code>pandas.Series</code> with <code>int64</code> values mapping seeds to
soil would cost 64GB memory - not the best solution.</p>
<p>So we take a different approach. For convenience, let&rsquo;s add a <code>src_end</code> and a
<code>dest_end</code> column to our maps:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> df <span style="color:#f92672">in</span> maps:
</span></span><span style="display:flex;"><span>    df[<span style="color:#e6db74">&#39;src_end&#39;</span>] <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>loc[:, <span style="color:#e6db74">&#39;src_start&#39;</span>] <span style="color:#f92672">+</span> df<span style="color:#f92672">.</span>loc[:, <span style="color:#e6db74">&#39;range&#39;</span>]
</span></span><span style="display:flex;"><span>    df[<span style="color:#e6db74">&#39;dest_end&#39;</span>] <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>loc[:, <span style="color:#e6db74">&#39;dest_start&#39;</span>] <span style="color:#f92672">+</span> df<span style="color:#f92672">.</span>loc[:, <span style="color:#e6db74">&#39;range&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Again the &#34;humidity-to-location&#34; map as an example:&#39;</span>)
</span></span><span style="display:flex;"><span>humi_loc
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Again the &#34;humidity-to-location&#34; map as an example:
</span></span></code></pre></div><p>Now we actually compute the mapping. For each seed, we go through all mappings
and in each mapping we go through each row. We find the row which contains the
mapping and exctract the destination, which is the source for the next map until
we reach the last map which gives us the locations.</p>
<ul>
<li>
<p>Approach 1: <code>df.itertuples()</code> is a convenient way to step through a
<code>pandas.DataFrame</code> in this example. It is faster than <code>df.iterrows()</code> and
returns the row as a <code>NamedTuple</code> -  nice!</p>
</li>
<li>
<p>Approach 2: I actually wondered if it would be faster to get all maps in one
<code>pd.DataFrame</code> and then iterate through the mappings. To test this let&rsquo;s
construct a new DataFrame <code>maps_df</code> which contains all <code>maps</code>. Since the maps
have different lengths it is important to cast the datatype to <code>Int64</code>, which
is short for <code>pd.Int64Dtype()</code> and keeps values as integers, even if <code>NA</code>
values are in the same column.</p>
</li>
<li>
<p>Approach 3: A third alternative I tested (not shown here) was to check if a
value is in a Python <code>range</code> with the <code>in</code> operator as in: <code>if 3 in range(5):...</code> . This was way too slow.</p>
</li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># mapping version 1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_location</span>(seed):
</span></span><span style="display:flex;"><span>    current <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> df <span style="color:#f92672">in</span> maps:
</span></span><span style="display:flex;"><span>        current_map <span style="color:#f92672">=</span> [row
</span></span><span style="display:flex;"><span>                       <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> df<span style="color:#f92672">.</span>itertuples()
</span></span><span style="display:flex;"><span>                       <span style="color:#66d9ef">if</span> ((current <span style="color:#f92672">&gt;</span> row<span style="color:#f92672">.</span>src_start)
</span></span><span style="display:flex;"><span>                           <span style="color:#f92672">and</span> (current <span style="color:#f92672">&lt;</span> row<span style="color:#f92672">.</span>src_end))]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(current_map) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> len(current_map) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            current <span style="color:#f92672">=</span> (current_map[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>dest_start
</span></span><span style="display:flex;"><span>                       <span style="color:#f92672">+</span> (current <span style="color:#f92672">-</span> current_map[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>src_start))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#39;This should not happen!&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> current
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># mapping version 2 - around 10 times slower</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># you need to rename the maps_df columns so that they have a unique id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># e.g. &#39;src_start_1&#39;, &#39;src_start_2&#39; etc</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># maps_df = pd.concat(maps, axis=&#39;columns&#39;)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># def get_dest(i, src):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     return (maps_df[(src &gt; maps_df.loc[:, f&#39;src_start_{i}&#39;]) &amp;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#                     (src &lt; maps_df.loc[:, f&#39;src_end_{i}&#39;])]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             .loc[:, f&#39;dest_start_{i}&#39;]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             .iloc[0])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># def get_location2(seed):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     dest = seed</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     i = 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     while i &lt; 7:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         dest = get_dest(i, dest)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         i += 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     return dest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span>timeit get_location(seeds[<span style="color:#ae81ff">0</span>])
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>7.89 ms Â± 1.37 ms per loop (mean Â± std. dev. of 7 runs, 100 loops each)
</span></span></code></pre></div><p>Now let&rsquo;s get a list of locations:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>locations <span style="color:#f92672">=</span> [get_location(s) <span style="color:#66d9ef">for</span> s <span style="color:#f92672">in</span> seeds]
</span></span><span style="display:flex;"><span>locations
</span></span></code></pre></div><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>2493982655</td>
<td>3209845376</td>
<td>3992357533</td>
<td>4163131463</td>
<td>4104485616</td>
<td>1952252479</td>
<td>3218677354</td>
<td>388071289</td>
<td>2181441450</td>
<td>2594336315</td>
<td>4049507670</td>
<td>2084517144</td>
<td>3119633635</td>
<td>428978312</td>
<td>3518771991</td>
<td>3704555655</td>
<td>953918455</td>
<td>2107687768</td>
<td>3448046330</td>
<td>2184454689</td>
</tr>
</tbody>
</table>
<p>Lastly, just get the minimum of all location values.</p>
<details>
<summary>Reveal solution!</summary>
<div class="details">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  min(locations)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>388071289
</span></span></code></pre></div></div>
</details>
<h2 id="part-2">
  Part 2
  <a class="anchor" href="#part-2">#</a>
</h2>
<blockquote>
<p>Everyone will starve if you only plant such a small number of seeds. Re-reading
the almanac, it looks like the <code>seeds:</code> line actually describes <strong>ranges of seed
numbers</strong>.</p>
<p>The values on the initial <code>seeds:</code> line come in pairs. Within each pair, the
first value is the <strong>start</strong> of the range and the second value is the <strong>length</strong> of
the range. So, in the first line of the example above:</p>
<p><code>seeds: 79 14 55 13</code></p>
<p>This line describes two ranges of seed numbers to be planted in the garden. The
first range starts with seed number <code>79</code> and contains <code>14</code> values: <code>79</code>, <code>80</code>,
&hellip;, <code>91</code>, <code>92</code>. The second range starts with seed number <code>55</code> and contains <code>13</code>
values: <code>55</code>, <code>56</code>, &hellip;, <code>66</code>, <code>67</code>.</p>
<p>Now, rather than considering four seed numbers, you need to consider a total of
<code>27</code> seed numbers.</p>
<p>In the above example, the lowest location number can be obtained from seed
number <code>82</code>, which corresponds to soil <code>84</code>, fertilizer <code>84</code>, water <code>84</code>, light
<code>77</code>, temperature <code>45</code>, humidity <code>46</code>, and location <code>46</code>. So, the lowest
location number is <code>46</code>.</p>
<p>Consider all of the initial seed numbers listed in the ranges on the first line
of the almanac. <strong>What is the lowest location number that corresponds to any of
the initial seed numbers?</strong></p>
</blockquote>
<p>Let&rsquo;s first construct a dataframe containing the range of seeds:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>seeds_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;start&#39;</span>: seeds[::<span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>                         <span style="color:#e6db74">&#39;range&#39;</span>: seeds[<span style="color:#ae81ff">1</span>::<span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>                         <span style="color:#e6db74">&#39;end&#39;</span>: seeds[::<span style="color:#ae81ff">2</span>] <span style="color:#f92672">+</span> seeds[<span style="color:#ae81ff">1</span>::<span style="color:#ae81ff">2</span>]})
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;There are </span><span style="color:#e6db74">{</span>sum(seeds_df<span style="color:#f92672">.</span>loc[:, <span style="color:#e6db74">&#34;range&#34;</span>])<span style="color:#e6db74">:</span><span style="color:#e6db74">_</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> seeds in total&#39;</span>)
</span></span><span style="display:flex;"><span>seeds_df
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>There are 2_549_759_327 seeds in total
</span></span></code></pre></div><p>Now - I really needed some time to finally realize, that going through all seed
values is really unfeasable. So how do we deal with this problem?</p>
<p>In the end we need the lowest location number - thus our approach is to take
the <code>humi_loc</code> map, start with the lowest location number and go up and get the
corresponding seed values. The location of the first seed value which is inside
<code>seeds_df</code> is our solution.</p>
<p>So first we rebuild the <code>get_location</code> function to a <code>get_seed</code> function (we
reverse the <code>maps</code> tuple with <code>maps[::-1]</code> and switch <code>src</code> and <code>dest</code>).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_seed</span>(location):
</span></span><span style="display:flex;"><span>    current <span style="color:#f92672">=</span> location
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> df <span style="color:#f92672">in</span> maps[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
</span></span><span style="display:flex;"><span>        current_map <span style="color:#f92672">=</span> [row
</span></span><span style="display:flex;"><span>                       <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> df<span style="color:#f92672">.</span>itertuples()
</span></span><span style="display:flex;"><span>                       <span style="color:#66d9ef">if</span> ((current <span style="color:#f92672">&gt;=</span> row<span style="color:#f92672">.</span>dest_start)
</span></span><span style="display:flex;"><span>                           <span style="color:#f92672">and</span> (current <span style="color:#f92672">&lt;</span> row<span style="color:#f92672">.</span>dest_end))]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(current_map) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> len(current_map) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            current <span style="color:#f92672">=</span> (current_map[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>src_start
</span></span><span style="display:flex;"><span>                       <span style="color:#f92672">+</span> (current <span style="color:#f92672">-</span> current_map[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>dest_start))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#39;This should not happen!&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> current
</span></span></code></pre></div><p>Since the Python 3 <code>range</code> function does not store it&rsquo;s contents in memory
(similar to a generator), it is well suited to go through these large ranges.</p>
<p>Lastly, we deal with the sheer amount of possible values by performing a <strong>grid
search</strong>. First, we check every millionth location. After the first match, we
stop this search and check the last million locations before the match with a
finer grid and so on. The last grid is just <code>1</code>, so we find our lowest location.</p>
<p>Update: We order our locations from smallest to largest with <code>sort_values</code> and
go through them - but the search stops after the first match, since that will be
our lowest location.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">grid_search</span>(start: int, end: int, grid: list[int]):
</span></span><span style="display:flex;"><span>    success <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> g <span style="color:#f92672">in</span> grid:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Start search with grid=</span><span style="color:#e6db74">{</span>g<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> l <span style="color:#f92672">in</span> range(start, end, g):
</span></span><span style="display:flex;"><span>            current <span style="color:#f92672">=</span> get_seed(l)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> any((current <span style="color:#f92672">&gt;=</span> seeds_df<span style="color:#f92672">.</span>loc[:, <span style="color:#e6db74">&#39;start&#39;</span>]) <span style="color:#f92672">&amp;</span> (current <span style="color:#f92672">&lt;</span> seeds_df<span style="color:#f92672">.</span>loc[:, <span style="color:#e6db74">&#39;end&#39;</span>])):
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;location </span><span style="color:#e6db74">{</span>l<span style="color:#e6db74">}</span><span style="color:#e6db74"> is the lowest which contains one of the given seeds (</span><span style="color:#e6db74">{</span>current<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>)
</span></span><span style="display:flex;"><span>                start <span style="color:#f92672">=</span> l <span style="color:#f92672">-</span> g
</span></span><span style="display:flex;"><span>                end <span style="color:#f92672">=</span> l
</span></span><span style="display:flex;"><span>                success <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> success
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> humi_loc<span style="color:#f92672">.</span>sort_values(<span style="color:#e6db74">&#39;dest_start&#39;</span>)<span style="color:#f92672">.</span>itertuples():
</span></span><span style="display:flex;"><span>    success <span style="color:#f92672">=</span> grid_search(start<span style="color:#f92672">=</span>row<span style="color:#f92672">.</span>dest_start, end<span style="color:#f92672">=</span>row<span style="color:#f92672">.</span>dest_end,
</span></span><span style="display:flex;"><span>                          grid<span style="color:#f92672">=</span>[<span style="color:#ae81ff">1_000_000</span>, <span style="color:#ae81ff">100_000</span>, <span style="color:#ae81ff">1000</span>, <span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> success:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;Finished search&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Start search with grid=1000000
</span></span><span style="display:flex;"><span>location 85000000 is the lowest which contains one of the given seeds (2605777210)
</span></span><span style="display:flex;"><span>Start search with grid=100000
</span></span><span style="display:flex;"><span>location 84300000 is the lowest which contains one of the given seeds (2605077210)
</span></span><span style="display:flex;"><span>Start search with grid=1000
</span></span><span style="display:flex;"><span>location 84207000 is the lowest which contains one of the given seeds (2604984210)
</span></span><span style="display:flex;"><span>Start search with grid=1
</span></span><span style="display:flex;"><span>location 84206669 is the lowest which contains one of the given seeds (2604983879)
</span></span><span style="display:flex;"><span>Finished search
</span></span></code></pre></div></p>
</article>
 
      

      <footer class="book-footer">
          
  <div class="flex flex-wrap justify-between">

  


  

  


  


<div class="book-languages" tabindex="0" aria-haspopup="true">
  <ul>
    <li class="flex align-center">
      <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
      English
    </li> 
  </ul>

  <ul class="book-languages-list">
    
    <li class="active">
      <a href="https://aseltmann.github.io/" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </li>
    
    <li class="">
      <a href="https://aseltmann.github.io/de/posts/aoc2023-day05/" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        Deutsch
      </a>
    </li>
    
  </ul>
</div>




  <div><a class="flex align-center" href="https://github.com/aseltmann/aseltmann.github.io-org-src/commit/03df8873c39a13b3fb28c06b64e9f1964836e68e" title='Last modified by Alex Seltmann | 2023-12-31' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>2023-12-31</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/aseltmann/aseltmann.github.io-org-src/edit/main/content//posts/aoc2023-day05.en.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>

</div>

 
      </footer>

      
  
  <div class="book-comments">
<div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "lexbn" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
  
 

      <footer class="book-footer">
          <div class="footer">
    
    
    Exported
    
    from <a href="https://github.com/aseltmann/aseltmann.github.io-org-src/raw/main/lexbn-source.org"> <code>lexbn-source.org</code></a>
    
    using
    
    <a href="https://www.gnu.org/software/emacs/">Emacs 29.1 </a> &plus;
    <a href="https://orgmode.org/">Org mode 9.7 </a> &plus;
    
    <a href="https://github.com/kaushalmodi/ox-hugo"><code>ox-hugo</code></a>
    and published using
    
    <a href="https://gohugo.io/">Hugo 0.121.1</a>
	  &plus; <a href="https://github.com/alex-shpak/hugo-book">Book</a>
    
</div>



 
      </footer>


      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#part-1">Part 1</a></li>
    <li><a href="#part-2">Part 2</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












